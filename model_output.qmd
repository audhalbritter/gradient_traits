---
title: "Model Assumption Checks"
format: html
editor: visual
css: |
  .model-section {
    margin: 40px 0;
    padding: 20px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background-color: #fafafa;
  }
  h3 {
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  .plot-container {
    margin: 20px 0;
  }
---

## Checking model assumptions

```{r}
#| label: set-up
#| echo: false
#| warning: false

library(tidyverse)
library(performance)
library(see)
library(targets)
library(tarchetypes)

# Load the data
tar_load(diversity_model_checks)
tar_load(trait_model_checks)
```

## Diversity Models

```{r}
#| label: diversity-model-checks
#| echo: false
#| results: asis

diversity_model_checks |> 
  select(diversity_index, model_check) |> 
  pwalk(.f = function(diversity_index, model_check, ...){
  # Create a nice header with spacing
  cat("\n\n")
  cat(paste("###", stringr::str_to_title(diversity_index), "- Elevation", "\n\n"))
  
  # Print the model check plots
  print(model_check)
  
  # Add spacing after the plot
  cat("\n\n")
})
  
```

## Trait Models

```{r}
#| label: trait-model-checks
#| echo: false
#| results: asis

trait_model_checks |> 
  select(trait_trans, climate_variable, data_source, model_check) |> 
  pwalk(.f = function(trait_trans, climate_variable, data_source, model_check, ...){
  # Create a nice header with spacing
  cat("\n\n")
  cat(paste("###", stringr::str_replace_all(trait_trans, "_", " ") |> stringr::str_to_title(), "-", 
            case_when(
              climate_variable == "growing_season_length" ~ "Growing Season Length (GEE)",
              climate_variable == "gsl_1981-2010_chelsa" ~ "Growing Season Length (CHELSA)",
              climate_variable == "gst_1981-2010_chelsa" ~ "Growing Season Temperature (CHELSA)",
              climate_variable == "gsp_1981-2010_chelsa" ~ "Growing Season Precipitation (CHELSA)",
              climate_variable == "pet_penman_mean_1981-2010_chelsa" ~ "Potential Evapotranspiration (CHELSA)",
              climate_variable == "mean_temperture_warmest_quarter_bioclim" ~ "Mean Temperature Warmest Quarter (WorldClim)",
              climate_variable == "precipitation_warmest_quarter_bioclim" ~ "Precipitation Warmest Quarter (WorldClim)",
              climate_variable == "diurnal_range_bioclim" ~ "Mean Diurnal Range (WorldClim)",
              climate_variable == "annual_temperature_bioclim" ~ "Annual Temperature (WorldClim)",
              TRUE ~ climate_variable
            ), "\n\n"))
  
  # Print the model check plots
  print(model_check)
  
  # Add spacing after the plot
  cat("\n\n")
})
  
```

##